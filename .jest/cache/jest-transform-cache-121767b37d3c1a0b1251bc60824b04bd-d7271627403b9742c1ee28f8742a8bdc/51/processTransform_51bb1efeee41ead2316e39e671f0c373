0da292f092f90ba085b825bc471046f8

'use strict';

var MatrixMath = require('MatrixMath');
var Platform = require('Platform');

var invariant = require('fbjs/lib/invariant');
var stringifySafe = require('stringifySafe');

function processTransform(transform) {
  if (__DEV__) {
    _validateTransforms(transform);
  }

  if (Platform.OS === 'android' || Platform.OS === 'ios') {
    return transform;
  }

  var result = MatrixMath.createIdentityMatrix();

  transform.forEach(function (transformation) {
    var key = Object.keys(transformation)[0];
    var value = transformation[key];

    switch (key) {
      case 'matrix':
        MatrixMath.multiplyInto(result, result, value);
        break;
      case 'perspective':
        _multiplyTransform(result, MatrixMath.reusePerspectiveCommand, [value]);
        break;
      case 'rotateX':
        _multiplyTransform(result, MatrixMath.reuseRotateXCommand, [_convertToRadians(value)]);
        break;
      case 'rotateY':
        _multiplyTransform(result, MatrixMath.reuseRotateYCommand, [_convertToRadians(value)]);
        break;
      case 'rotate':
      case 'rotateZ':
        _multiplyTransform(result, MatrixMath.reuseRotateZCommand, [_convertToRadians(value)]);
        break;
      case 'scale':
        _multiplyTransform(result, MatrixMath.reuseScaleCommand, [value]);
        break;
      case 'scaleX':
        _multiplyTransform(result, MatrixMath.reuseScaleXCommand, [value]);
        break;
      case 'scaleY':
        _multiplyTransform(result, MatrixMath.reuseScaleYCommand, [value]);
        break;
      case 'translate':
        _multiplyTransform(result, MatrixMath.reuseTranslate3dCommand, [value[0], value[1], value[2] || 0]);
        break;
      case 'translateX':
        _multiplyTransform(result, MatrixMath.reuseTranslate2dCommand, [value, 0]);
        break;
      case 'translateY':
        _multiplyTransform(result, MatrixMath.reuseTranslate2dCommand, [0, value]);
        break;
      case 'skewX':
        _multiplyTransform(result, MatrixMath.reuseSkewXCommand, [_convertToRadians(value)]);
        break;
      case 'skewY':
        _multiplyTransform(result, MatrixMath.reuseSkewYCommand, [_convertToRadians(value)]);
        break;
      default:
        throw new Error('Invalid transform name: ' + key);
    }
  });

  return result;
}

function _multiplyTransform(result, matrixMathFunction, args) {
  var matrixToApply = MatrixMath.createIdentityMatrix();
  var argsWithIdentity = [matrixToApply].concat(args);
  matrixMathFunction.apply(this, argsWithIdentity);
  MatrixMath.multiplyInto(result, result, matrixToApply);
}

function _convertToRadians(value) {
  var floatValue = parseFloat(value);
  return value.indexOf('rad') > -1 ? floatValue : floatValue * Math.PI / 180;
}

function _validateTransforms(transform) {
  transform.forEach(function (transformation) {
    var keys = Object.keys(transformation);
    invariant(keys.length === 1, 'You must specify exactly one property per transform object. Passed properties: %s', stringifySafe(transformation));
    var key = keys[0];
    var value = transformation[key];
    _validateTransform(key, value, transformation);
  });
}

function _validateTransform(key, value, transformation) {
  invariant(!value.getValue, 'You passed an Animated.Value to a normal component. ' + 'You need to wrap that component in an Animated. For example, ' + 'replace <View /> by <Animated.View />.');

  var multivalueTransforms = ['matrix', 'translate'];
  if (multivalueTransforms.indexOf(key) !== -1) {
    invariant(Array.isArray(value), 'Transform with key of %s must have an array as the value: %s', key, stringifySafe(transformation));
  }
  switch (key) {
    case 'matrix':
      invariant(value.length === 9 || value.length === 16, 'Matrix transform must have a length of 9 (2d) or 16 (3d). ' + 'Provided matrix has a length of %s: %s', value.length, stringifySafe(transformation));
      break;
    case 'translate':
      invariant(value.length === 2 || value.length === 3, 'Transform with key translate must be an array of length 2 or 3, found %s: %s', value.length, stringifySafe(transformation));
      break;
    case 'rotateX':
    case 'rotateY':
    case 'rotateZ':
    case 'rotate':
    case 'skewX':
    case 'skewY':
      invariant(typeof value === 'string', 'Transform with key of "%s" must be a string: %s', key, stringifySafe(transformation));
      invariant(value.indexOf('deg') > -1 || value.indexOf('rad') > -1, 'Rotate transform must be expressed in degrees (deg) or radians ' + '(rad): %s', stringifySafe(transformation));
      break;
    case 'perspective':
      invariant(typeof value === 'number', 'Transform with key of "%s" must be a number: %s', key, stringifySafe(transformation));
      invariant(value !== 0, 'Transform with key of "%s" cannot be zero: %s', key, stringifySafe(transformation));
      break;
    case 'translateX':
    case 'translateY':
    case 'scale':
    case 'scaleX':
    case 'scaleY':
      invariant(typeof value === 'number', 'Transform with key of "%s" must be a number: %s', key, stringifySafe(transformation));
      break;
    default:
      invariant(false, 'Invalid transform %s: %s', key, stringifySafe(transformation));
  }
}

module.exports = processTransform;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb2Nlc3NUcmFuc2Zvcm0uanMiXSwibmFtZXMiOlsiTWF0cml4TWF0aCIsInJlcXVpcmUiLCJQbGF0Zm9ybSIsImludmFyaWFudCIsInN0cmluZ2lmeVNhZmUiLCJwcm9jZXNzVHJhbnNmb3JtIiwidHJhbnNmb3JtIiwiX19ERVZfXyIsIl92YWxpZGF0ZVRyYW5zZm9ybXMiLCJPUyIsInJlc3VsdCIsImNyZWF0ZUlkZW50aXR5TWF0cml4IiwiZm9yRWFjaCIsImtleSIsIk9iamVjdCIsImtleXMiLCJ0cmFuc2Zvcm1hdGlvbiIsInZhbHVlIiwibXVsdGlwbHlJbnRvIiwiX211bHRpcGx5VHJhbnNmb3JtIiwicmV1c2VQZXJzcGVjdGl2ZUNvbW1hbmQiLCJyZXVzZVJvdGF0ZVhDb21tYW5kIiwiX2NvbnZlcnRUb1JhZGlhbnMiLCJyZXVzZVJvdGF0ZVlDb21tYW5kIiwicmV1c2VSb3RhdGVaQ29tbWFuZCIsInJldXNlU2NhbGVDb21tYW5kIiwicmV1c2VTY2FsZVhDb21tYW5kIiwicmV1c2VTY2FsZVlDb21tYW5kIiwicmV1c2VUcmFuc2xhdGUzZENvbW1hbmQiLCJyZXVzZVRyYW5zbGF0ZTJkQ29tbWFuZCIsInJldXNlU2tld1hDb21tYW5kIiwicmV1c2VTa2V3WUNvbW1hbmQiLCJFcnJvciIsIm1hdHJpeE1hdGhGdW5jdGlvbiIsImFyZ3MiLCJtYXRyaXhUb0FwcGx5IiwiYXJnc1dpdGhJZGVudGl0eSIsImNvbmNhdCIsImFwcGx5IiwiZmxvYXRWYWx1ZSIsInBhcnNlRmxvYXQiLCJpbmRleE9mIiwiTWF0aCIsIlBJIiwibGVuZ3RoIiwiX3ZhbGlkYXRlVHJhbnNmb3JtIiwiZ2V0VmFsdWUiLCJtdWx0aXZhbHVlVHJhbnNmb3JtcyIsIkFycmF5IiwiaXNBcnJheSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7QUFTQTs7QUFFQSxJQUFJQSxhQUFhQyxRQUFRLFlBQVIsQ0FBakI7QUFDQSxJQUFJQyxXQUFXRCxRQUFRLFVBQVIsQ0FBZjs7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RixFQUlFVCxjQUFjWSxjQUFkLENBSkY7QUFNQTtBQUNGLFNBQUssWUFBTDtBQUNBLFNBQUssWUFBTDtBQUNBLFNBQUssT0FBTDtBQUNBLFNBQUssUUFBTDtBQUNBLFNBQUssUUFBTDtBQUNFYixnQkFDRSxPQUFPYyxLQUFQLEtBQWlCLFFBRG5CLEVBRUUsaURBRkYsRUFHRUosR0FIRixFQUlFVCxjQUFjWSxjQUFkLENBSkY7QUFNQTtBQUNGO0FBQ0ViLGdCQUFVLEtBQVYsRUFBaUIsMEJBQWpCLEVBQTZDVSxHQUE3QyxFQUFrRFQsY0FBY1ksY0FBZCxDQUFsRDtBQWhFSjtBQWtFRDs7QUFFRGtDLE9BQU9DLE9BQVAsR0FBaUI5QyxnQkFBakIiLCJmaWxlIjoicHJvY2Vzc1RyYW5zZm9ybS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQHByb3ZpZGVzTW9kdWxlIHByb2Nlc3NUcmFuc2Zvcm1cbiAqIEBmbG93XG4gKi9cbid1c2Ugc3RyaWN0JztcblxudmFyIE1hdHJpeE1hdGggPSByZXF1aXJlKCdNYXRyaXhNYXRoJyk7XG52YXIgUGxhdGZvcm0gPSByZXF1aXJlKCdQbGF0Zm9ybScpO1xuXG52YXIgaW52YXJpYW50ID0gcmVxdWlyZSgnZmJqcy9saWIvaW52YXJpYW50Jyk7XG52YXIgc3RyaW5naWZ5U2FmZSA9IHJlcXVpcmUoJ3N0cmluZ2lmeVNhZmUnKTtcblxuLyoqXG4gKiBHZW5lcmF0ZSBhIHRyYW5zZm9ybSBtYXRyaXggYmFzZWQgb24gdGhlIHByb3ZpZGVkIHRyYW5zZm9ybXMsIGFuZCB1c2UgdGhhdFxuICogd2l0aGluIHRoZSBzdHlsZSBvYmplY3QgaW5zdGVhZC5cbiAqXG4gKiBUaGlzIGFsbG93cyB1cyB0byBwcm92aWRlIGFuIEFQSSB0aGF0IGlzIHNpbWlsYXIgdG8gQ1NTLCB3aGVyZSB0cmFuc2Zvcm1zIG1heVxuICogYmUgYXBwbGllZCBpbiBhbiBhcmJpdHJhcnkgb3JkZXIsIGFuZCB5ZXQgaGF2ZSBhIHVuaXZlcnNhbCwgc2luZ3VsYXJcbiAqIGludGVyZmFjZSB0byBuYXRpdmUgY29kZS5cbiAqL1xuZnVuY3Rpb24gcHJvY2Vzc1RyYW5zZm9ybSh0cmFuc2Zvcm06IEFycmF5PE9iamVjdD4pOiBBcnJheTxPYmplY3Q+IHwgQXJyYXk8bnVtYmVyPiB7XG4gIGlmIChfX0RFVl9fKSB7XG4gICAgX3ZhbGlkYXRlVHJhbnNmb3Jtcyh0cmFuc2Zvcm0pO1xuICB9XG5cbiAgLy8gQW5kcm9pZCAmIGlPUyBpbXBsZW1lbnRhdGlvbnMgb2YgdHJhbnNmb3JtIHByb3BlcnR5IGFjY2VwdCB0aGUgbGlzdCBvZlxuICAvLyB0cmFuc2Zvcm0gcHJvcGVydGllcyBhcyBvcHBvc2VkIHRvIGEgdHJhbnNmb3JtIE1hdHJpeC4gVGhpcyBpcyBuZWNlc3NhcnlcbiAgLy8gdG8gY29udHJvbCB0cmFuc2Zvcm0gcHJvcGVydHkgdXBkYXRlcyBjb21wbGV0ZWx5IG9uIHRoZSBuYXRpdmUgdGhyZWFkLlxuICBpZiAoUGxhdGZvcm0uT1MgPT09ICdhbmRyb2lkJyB8fCBQbGF0Zm9ybS5PUyA9PT0gJ2lvcycpIHtcbiAgICByZXR1cm4gdHJhbnNmb3JtO1xuICB9XG5cbiAgdmFyIHJlc3VsdCA9IE1hdHJpeE1hdGguY3JlYXRlSWRlbnRpdHlNYXRyaXgoKTtcblxuICB0cmFuc2Zvcm0uZm9yRWFjaCh0cmFuc2Zvcm1hdGlvbiA9PiB7XG4gICAgdmFyIGtleSA9IE9iamVjdC5rZXlzKHRyYW5zZm9ybWF0aW9uKVswXTtcbiAgICB2YXIgdmFsdWUgPSB0cmFuc2Zvcm1hdGlvbltrZXldO1xuXG4gICAgc3dpdGNoIChrZXkpIHtcbiAgICAgIGNhc2UgJ21hdHJpeCc6XG4gICAgICAgIE1hdHJpeE1hdGgubXVsdGlwbHlJbnRvKHJlc3VsdCwgcmVzdWx0LCB2YWx1ZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAncGVyc3BlY3RpdmUnOlxuICAgICAgICBfbXVsdGlwbHlUcmFuc2Zvcm0ocmVzdWx0LCBNYXRyaXhNYXRoLnJldXNlUGVyc3BlY3RpdmVDb21tYW5kLCBbdmFsdWVdKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdyb3RhdGVYJzpcbiAgICAgICAgX211bHRpcGx5VHJhbnNmb3JtKHJlc3VsdCwgTWF0cml4TWF0aC5yZXVzZVJvdGF0ZVhDb21tYW5kLCBbX2NvbnZlcnRUb1JhZGlhbnModmFsdWUpXSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAncm90YXRlWSc6XG4gICAgICAgIF9tdWx0aXBseVRyYW5zZm9ybShyZXN1bHQsIE1hdHJpeE1hdGgucmV1c2VSb3RhdGVZQ29tbWFuZCwgW19jb252ZXJ0VG9SYWRpYW5zKHZhbHVlKV0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3JvdGF0ZSc6XG4gICAgICBjYXNlICdyb3RhdGVaJzpcbiAgICAgICAgX211bHRpcGx5VHJhbnNmb3JtKHJlc3VsdCwgTWF0cml4TWF0aC5yZXVzZVJvdGF0ZVpDb21tYW5kLCBbX2NvbnZlcnRUb1JhZGlhbnModmFsdWUpXSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnc2NhbGUnOlxuICAgICAgICBfbXVsdGlwbHlUcmFuc2Zvcm0ocmVzdWx0LCBNYXRyaXhNYXRoLnJldXNlU2NhbGVDb21tYW5kLCBbdmFsdWVdKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdzY2FsZVgnOlxuICAgICAgICBfbXVsdGlwbHlUcmFuc2Zvcm0ocmVzdWx0LCBNYXRyaXhNYXRoLnJldXNlU2NhbGVYQ29tbWFuZCwgW3ZhbHVlXSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnc2NhbGVZJzpcbiAgICAgICAgX211bHRpcGx5VHJhbnNmb3JtKHJlc3VsdCwgTWF0cml4TWF0aC5yZXVzZVNjYWxlWUNvbW1hbmQsIFt2YWx1ZV0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3RyYW5zbGF0ZSc6XG4gICAgICAgIF9tdWx0aXBseVRyYW5zZm9ybShyZXN1bHQsIE1hdHJpeE1hdGgucmV1c2VUcmFuc2xhdGUzZENvbW1hbmQsIFt2YWx1ZVswXSwgdmFsdWVbMV0sIHZhbHVlWzJdIHx8IDBdKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICd0cmFuc2xhdGVYJzpcbiAgICAgICAgX211bHRpcGx5VHJhbnNmb3JtKHJlc3VsdCwgTWF0cml4TWF0aC5yZXVzZVRyYW5zbGF0ZTJkQ29tbWFuZCwgW3ZhbHVlLCAwXSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAndHJhbnNsYXRlWSc6XG4gICAgICAgIF9tdWx0aXBseVRyYW5zZm9ybShyZXN1bHQsIE1hdHJpeE1hdGgucmV1c2VUcmFuc2xhdGUyZENvbW1hbmQsIFswLCB2YWx1ZV0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3NrZXdYJzpcbiAgICAgICAgX211bHRpcGx5VHJhbnNmb3JtKHJlc3VsdCwgTWF0cml4TWF0aC5yZXVzZVNrZXdYQ29tbWFuZCwgW19jb252ZXJ0VG9SYWRpYW5zKHZhbHVlKV0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3NrZXdZJzpcbiAgICAgICAgX211bHRpcGx5VHJhbnNmb3JtKHJlc3VsdCwgTWF0cml4TWF0aC5yZXVzZVNrZXdZQ29tbWFuZCwgW19jb252ZXJ0VG9SYWRpYW5zKHZhbHVlKV0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCB0cmFuc2Zvcm0gbmFtZTogJyArIGtleSk7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gcmVzdWx0O1xufVxuXG4vKipcbiAqIFBlcmZvcm1zIGEgZGVzdHJ1Y3RpdmUgb3BlcmF0aW9uIG9uIGEgdHJhbnNmb3JtIG1hdHJpeC5cbiAqL1xuZnVuY3Rpb24gX211bHRpcGx5VHJhbnNmb3JtKFxuICByZXN1bHQ6IEFycmF5PG51bWJlcj4sXG4gIG1hdHJpeE1hdGhGdW5jdGlvbjogRnVuY3Rpb24sXG4gIGFyZ3M6IEFycmF5PG51bWJlcj5cbik6IHZvaWQge1xuICB2YXIgbWF0cml4VG9BcHBseSA9IE1hdHJpeE1hdGguY3JlYXRlSWRlbnRpdHlNYXRyaXgoKTtcbiAgdmFyIGFyZ3NXaXRoSWRlbnRpdHkgPSBbbWF0cml4VG9BcHBseV0uY29uY2F0KGFyZ3MpO1xuICBtYXRyaXhNYXRoRnVuY3Rpb24uYXBwbHkodGhpcywgYXJnc1dpdGhJZGVudGl0eSk7XG4gIE1hdHJpeE1hdGgubXVsdGlwbHlJbnRvKHJlc3VsdCwgcmVzdWx0LCBtYXRyaXhUb0FwcGx5KTtcbn1cblxuLyoqXG4gKiBQYXJzZXMgYSBzdHJpbmcgbGlrZSAnMC41cmFkJyBvciAnNjBkZWcnIGludG8gcmFkaWFucyBleHByZXNzZWQgaW4gYSBmbG9hdC5cbiAqIE5vdGUgdGhhdCB2YWxpZGF0aW9uIG9uIHRoZSBzdHJpbmcgaXMgZG9uZSBpbiBgX3ZhbGlkYXRlVHJhbnNmb3JtKClgLlxuICovXG5mdW5jdGlvbiBfY29udmVydFRvUmFkaWFucyh2YWx1ZTogc3RyaW5nKTogbnVtYmVyIHtcbiAgdmFyIGZsb2F0VmFsdWUgPSBwYXJzZUZsb2F0KHZhbHVlKTtcbiAgcmV0dXJuIHZhbHVlLmluZGV4T2YoJ3JhZCcpID4gLTEgPyBmbG9hdFZhbHVlIDogZmxvYXRWYWx1ZSAqIE1hdGguUEkgLyAxODA7XG59XG5cbmZ1bmN0aW9uIF92YWxpZGF0ZVRyYW5zZm9ybXModHJhbnNmb3JtOiBBcnJheTxPYmplY3Q+KTogdm9pZCB7XG4gIHRyYW5zZm9ybS5mb3JFYWNoKHRyYW5zZm9ybWF0aW9uID0+IHtcbiAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKHRyYW5zZm9ybWF0aW9uKTtcbiAgICBpbnZhcmlhbnQoXG4gICAgICBrZXlzLmxlbmd0aCA9PT0gMSxcbiAgICAgICdZb3UgbXVzdCBzcGVjaWZ5IGV4YWN0bHkgb25lIHByb3BlcnR5IHBlciB0cmFuc2Zvcm0gb2JqZWN0LiBQYXNzZWQgcHJvcGVydGllczogJXMnLFxuICAgICAgc3RyaW5naWZ5U2FmZSh0cmFuc2Zvcm1hdGlvbiksXG4gICAgKTtcbiAgICB2YXIga2V5ID0ga2V5c1swXTtcbiAgICB2YXIgdmFsdWUgPSB0cmFuc2Zvcm1hdGlvbltrZXldO1xuICAgIF92YWxpZGF0ZVRyYW5zZm9ybShrZXksIHZhbHVlLCB0cmFuc2Zvcm1hdGlvbik7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBfdmFsaWRhdGVUcmFuc2Zvcm0oa2V5LCB2YWx1ZSwgdHJhbnNmb3JtYXRpb24pIHtcbiAgaW52YXJpYW50KFxuICAgICF2YWx1ZS5nZXRWYWx1ZSxcbiAgICAnWW91IHBhc3NlZCBhbiBBbmltYXRlZC5WYWx1ZSB0byBhIG5vcm1hbCBjb21wb25lbnQuICcgK1xuICAgICdZb3UgbmVlZCB0byB3cmFwIHRoYXQgY29tcG9uZW50IGluIGFuIEFuaW1hdGVkLiBGb3IgZXhhbXBsZSwgJyArXG4gICAgJ3JlcGxhY2UgPFZpZXcgLz4gYnkgPEFuaW1hdGVkLlZpZXcgLz4uJ1xuICApO1xuXG4gIHZhciBtdWx0aXZhbHVlVHJhbnNmb3JtcyA9IFtcbiAgICAnbWF0cml4JyxcbiAgICAndHJhbnNsYXRlJyxcbiAgXTtcbiAgaWYgKG11bHRpdmFsdWVUcmFuc2Zvcm1zLmluZGV4T2Yoa2V5KSAhPT0gLTEpIHtcbiAgICBpbnZhcmlhbnQoXG4gICAgICBBcnJheS5pc0FycmF5KHZhbHVlKSxcbiAgICAgICdUcmFuc2Zvcm0gd2l0aCBrZXkgb2YgJXMgbXVzdCBoYXZlIGFuIGFycmF5IGFzIHRoZSB2YWx1ZTogJXMnLFxuICAgICAga2V5LFxuICAgICAgc3RyaW5naWZ5U2FmZSh0cmFuc2Zvcm1hdGlvbiksXG4gICAgKTtcbiAgfVxuICBzd2l0Y2ggKGtleSkge1xuICAgIGNhc2UgJ21hdHJpeCc6XG4gICAgICBpbnZhcmlhbnQoXG4gICAgICAgIHZhbHVlLmxlbmd0aCA9PT0gOSB8fCB2YWx1ZS5sZW5ndGggPT09IDE2LFxuICAgICAgICAnTWF0cml4IHRyYW5zZm9ybSBtdXN0IGhhdmUgYSBsZW5ndGggb2YgOSAoMmQpIG9yIDE2ICgzZCkuICcgK1xuICAgICAgICAgICdQcm92aWRlZCBtYXRyaXggaGFzIGEgbGVuZ3RoIG9mICVzOiAlcycsXG4gICAgICAgIHZhbHVlLmxlbmd0aCxcbiAgICAgICAgc3RyaW5naWZ5U2FmZSh0cmFuc2Zvcm1hdGlvbiksXG4gICAgICApO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAndHJhbnNsYXRlJzpcbiAgICAgIGludmFyaWFudChcbiAgICAgICAgdmFsdWUubGVuZ3RoID09PSAyIHx8IHZhbHVlLmxlbmd0aCA9PT0gMyxcbiAgICAgICAgJ1RyYW5zZm9ybSB3aXRoIGtleSB0cmFuc2xhdGUgbXVzdCBiZSBhbiBhcnJheSBvZiBsZW5ndGggMiBvciAzLCBmb3VuZCAlczogJXMnLFxuICAgICAgICB2YWx1ZS5sZW5ndGgsXG4gICAgICAgIHN0cmluZ2lmeVNhZmUodHJhbnNmb3JtYXRpb24pLFxuICAgICAgKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ3JvdGF0ZVgnOlxuICAgIGNhc2UgJ3JvdGF0ZVknOlxuICAgIGNhc2UgJ3JvdGF0ZVonOlxuICAgIGNhc2UgJ3JvdGF0ZSc6XG4gICAgY2FzZSAnc2tld1gnOlxuICAgIGNhc2UgJ3NrZXdZJzpcbiAgICAgIGludmFyaWFudChcbiAgICAgICAgdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyxcbiAgICAgICAgJ1RyYW5zZm9ybSB3aXRoIGtleSBvZiBcIiVzXCIgbXVzdCBiZSBhIHN0cmluZzogJXMnLFxuICAgICAgICBrZXksXG4gICAgICAgIHN0cmluZ2lmeVNhZmUodHJhbnNmb3JtYXRpb24pLFxuICAgICAgKTtcbiAgICAgIGludmFyaWFudChcbiAgICAgICAgdmFsdWUuaW5kZXhPZignZGVnJykgPiAtMSB8fCB2YWx1ZS5pbmRleE9mKCdyYWQnKSA+IC0xLFxuICAgICAgICAnUm90YXRlIHRyYW5zZm9ybSBtdXN0IGJlIGV4cHJlc3NlZCBpbiBkZWdyZWVzIChkZWcpIG9yIHJhZGlhbnMgJyArXG4gICAgICAgICAgJyhyYWQpOiAlcycsXG4gICAgICAgIHN0cmluZ2lmeVNhZmUodHJhbnNmb3JtYXRpb24pLFxuICAgICAgKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ3BlcnNwZWN0aXZlJzpcbiAgICAgIGludmFyaWFudChcbiAgICAgICAgdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyxcbiAgICAgICAgJ1RyYW5zZm9ybSB3aXRoIGtleSBvZiBcIiVzXCIgbXVzdCBiZSBhIG51bWJlcjogJXMnLFxuICAgICAgICBrZXksXG4gICAgICAgIHN0cmluZ2lmeVNhZmUodHJhbnNmb3JtYXRpb24pLFxuICAgICAgKTtcbiAgICAgIGludmFyaWFudChcbiAgICAgICAgdmFsdWUgIT09IDAsXG4gICAgICAgICdUcmFuc2Zvcm0gd2l0aCBrZXkgb2YgXCIlc1wiIGNhbm5vdCBiZSB6ZXJvOiAlcycsXG4gICAgICAgIGtleSxcbiAgICAgICAgc3RyaW5naWZ5U2FmZSh0cmFuc2Zvcm1hdGlvbiksXG4gICAgICApO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAndHJhbnNsYXRlWCc6XG4gICAgY2FzZSAndHJhbnNsYXRlWSc6XG4gICAgY2FzZSAnc2NhbGUnOlxuICAgIGNhc2UgJ3NjYWxlWCc6XG4gICAgY2FzZSAnc2NhbGVZJzpcbiAgICAgIGludmFyaWFudChcbiAgICAgICAgdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyxcbiAgICAgICAgJ1RyYW5zZm9ybSB3aXRoIGtleSBvZiBcIiVzXCIgbXVzdCBiZSBhIG51bWJlcjogJXMnLFxuICAgICAgICBrZXksXG4gICAgICAgIHN0cmluZ2lmeVNhZmUodHJhbnNmb3JtYXRpb24pLFxuICAgICAgKTtcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6XG4gICAgICBpbnZhcmlhbnQoZmFsc2UsICdJbnZhbGlkIHRyYW5zZm9ybSAlczogJXMnLCBrZXksIHN0cmluZ2lmeVNhZmUodHJhbnNmb3JtYXRpb24pKTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHByb2Nlc3NUcmFuc2Zvcm07XG4iXX0=